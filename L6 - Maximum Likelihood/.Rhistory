data <- Hmda %>% mutate(deny = 1*(deny=="yes"), lvr_high = (lvr > 0.95), lvr_med = (0.8 <= lvr) &(lvr <= 0.95))
probit <- feglm(deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi,
data = data,
family = binomial(link = "probit"))
logit <- feglm(deny ~ dir + hir + single + self+ black, data = data,
family = binomial(link = "logit"))
etable(probit,logit)
data <- Hmda %>% mutate(deny = 1*(deny=="yes"), lvr_high = (lvr > 0.95), lvr_med = (0.8 <= lvr) &(lvr <= 0.95))
probit <- feglm(deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi,
data = data,family = binomial(link = "probit"))
logit <- feglm(deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi,
data=data, family = binomial(link = "logit"))
etable(probit,logit)
library("Ecdat")
library("fixest")
data("Hmda")
data <- Hmda %>% mutate(deny = 1*(deny=="yes"),
lvr_high = (lvr > 0.95),
lvr_med = (0.8 <= lvr) &(lvr <= 0.95)
)
formula = "deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi"
probit <- feglm(formula,data = data,family = binomial(link = "probit"))
formula =  as.formula("deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi")
probit <- feglm(formula,data = data,family = binomial(link = "probit"))
probit
formula =  as.formula("deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi")
lpm  <- feols(formula, data=data)
probit <- feglm(formula, data=data, family = binomial(link = "probit"))
logit  <- feglm(formula, data=data, family = binomial(link = "logit"))
etable(lpm, probit,logit)
avg_predictions(lpm)
avg_comparisons(model = )
??avg_comparisons
comparisons(lpm)
comparisons(lpm,variables = "black")
avg_comparisons(lpm,variables = "black")
avg_slopes(lpm,variables = "black")
avg_comparisons(lpm,variables = "black")
avg_comparisons(logit,variables = "black")
avg_comparisons(probit,variables = "black")
avg_comparisons(probit,variables = "black")
avg_comparisons(probit,variables = "black")
avg_comparisons(probit,variables = "black")
avg_comparisons(probit,variables = "black")
avg_comparisons(probit,variables = "black")
slopes(probit)
library(patchwork)
install.packges('patchwork')
install.packages('patchwork')
library(patchwork)
p = predictions(mod)
library(patchwork)
library(patchwork)
p = predictions(mod)
library(marginaleffects)
dat = get_dataset("thornton")
y
install.packages('nanoparquet')
y
library(marginaleffects)
dat = get_dataset("thornton")
install.packages('Rdatasets')
library(marginaleffects)
dat = get_dataset("thornton")
mod = glm(outcome ~ incentive + agecat, data = dat, family = binomial)
mod
b = coef(mod)
b
library("Ecdat")
library("fixest")
data("Hmda")
data <- Hmda %>% mutate(deny = 1*(deny=="yes"),
lvr_high = (lvr > 0.95),
lvr_med = (0.8 <= lvr) &(lvr <= 0.95)
)
formula =  as.formula("deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi")
lpm  <- feols(formula, data=data)
probit <- feglm(formula, data=data, family = binomial(link = "probit"))
logit  <- feglm(formula, data=data, family = binomial(link = "logit"))
etable(lpm, probit,logit)
mfx_probit <- marginaleffects(probit)
etable(
lpm, probit, logit,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_med" = "LTV: medium",
"lvr_high" = "LTV: high"
),
title = "Loan Denial Models (LPM, Probit, Logit)"
)
avg_slopes(probit, variables = "black")
avg_slopes(logit,  variables = "black")
# Estimate models
lpm    <- feols(formula, data = data)
probit <- feglm(formula, data = data, family = binomial(link = "probit"))
logit  <- feglm(formula, data = data, family = binomial(link = "logit"))
# === Compute marginal effects for 'black' ===
ame_probit <- avg_slopes(probit, variables = "black")
ame_logit  <- avg_slopes(logit,  variables = "black")
# Extract the numeric AME values and SEs
ame_tbl <- data.frame(
Model = c("Probit AME (black)", "Logit AME (black)"),
Estimate = c(ame_probit$estimate, ame_logit$estimate),
Std_Error = c(ame_probit$std.error, ame_logit$std.error)
)
print(ame_tbl)
ame_lpm <- avg_slopes(lpm, variables = "black")
ame_probit <- avg_slopes(probit, variables = "black")
ame_logit  <- avg_slopes(logit,  variables = "black")
# Extract the numeric AME values and SEs
ame_tbl <- data.frame(
Model = c("Probit AME (black)", "Logit AME (black)"),
Estimate = c(ame_lpm$estimate, ame_probit$estimate, ame_logit$estimate),
Std_Error = c(ame_lpm$std.error, ame_probit$std.error, ame_logit$std.error)
)
ame_lpm <- avg_slopes(lpm, variables = "black")
ame_probit <- avg_slopes(probit, variables = "black")
ame_logit  <- avg_slopes(logit,  variables = "black")
# Extract the numeric AME values and SEs
ame_tbl <- data.frame(
Model = c("LPM AME (black)","Probit AME (black)", "Logit AME (black)"),
Estimate = c(ame_lpm$estimate, ame_probit$estimate, ame_logit$estimate),
Std_Error = c(ame_lpm$std.error, ame_probit$std.error, ame_logit$std.error)
)
ame_tbl
print(ame_tbl)
print(ame_tbl,3)
print(ame_tbl, digits=3)
print(ame_tbl,digits=3)
print(ame_tbl,digits=3)
data("Hmda")
data <- Hmda %>% mutate(deny = 1*(deny=="yes"),
lvr_high = (lvr > 0.95),
lvr_med = ((0.8 <= lvr) &(lvr <= 0.95)),
)
library("Ecdat")
library("fixest")
library("tidyverse")
data("Hmda")
data <- Hmda %>% mutate(deny = 1*(deny=="yes"),
lvr_high = (lvr > 0.95),
lvr_med = ((0.8 <= lvr) &(lvr <= 0.95)),
)
formula =  as.formula("deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi")
lpm  <- feols(formula, data=data)
probit <- feglm(formula, data=data, family = binomial(link = "probit"))
logit  <- feglm(formula, data=data, family = binomial(link = "logit"))
etable(lpm, probit,logit)
Now let's compute the marginal effects
tab_tex <- etable(lpm, probit, logit, tex = TRUE)
tab_tex
tab_tex <- etable(lpm, probit, logit, digits=3, tex = TRUE)
print(tab_tex)
tab_tex <- etable(lpm, probit, logit, digits=2, tex = TRUE)
ame_tex <- knitr::kable(ame_tbl, format = "latex", booktabs = TRUE, caption = "Average Marginal Effects for 'black'")
writeLines(c(tab_tex, "\n\n", ame_tex), "etable_with_ame.tex")
tools::texi2pdf("etable_with_ame.tex", clean = TRUE)
setwd("~/Documents/GitHub/applied_metrics/L6 - Maximum Likelihood")
ame_tex <- knitr::kable(ame_tbl, format = "latex", booktabs = TRUE, caption = "Average Marginal Effects for 'black'")
writeLines(c(tab_tex, "\n\n", ame_tex), "etable_with_ame.tex")
tools::texi2pdf("etable_with_ame.tex", clean = TRUE)
ame_tex <- knitr::kable(ame_tbl, format = "latex", booktabs = TRUE, caption = "Average Marginal Effects for 'black'")
writeLines(c(tab_tex, "\n\n", ame_tex), "etable_with_ame.tex")
library("Ecdat")
library("fixest")
library("tidyverse")
data("Hmda")
data <- Hmda %>% mutate(deny = 1*(deny=="yes"),
lvr_high = (lvr > 0.95),
lvr_med = ((0.8 <= lvr) &(lvr <= 0.95)),
)
formula =  as.formula("deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi")
lpm  <- feols(formula, data=data)
probit <- feglm(formula, data=data, family = binomial(link = "probit"))
logit  <- feglm(formula, data=data, family = binomial(link = "logit"))
tab_tex <- etable(lpm, probit, logit, digits=2, tex = TRUE)
etable(lpm, probit, logit, digits=2, tex = TRUE)
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~r2 + n,
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_med" = "LTV: Medium",
"lvr_high" = "LTV: High"
)
)
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~r2 + n,
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High"
)
)
tab
print(tab)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~r2 + n,
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"lvr_highTRUE" = "LTV: High"
)
)
print(tab)
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~r2 + n,
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"lvr_highTRUE" = "LTV: High"
)
etable(
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
fitstat = ~r2 + n,
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"lvr_highTRUE" = "LTV: High"
)
)
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"lvr_highTRUE" = "LTV: High"
))
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,
dict = c(
"black" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"lvr_highTRUE" = "LTV: High"
))
table1
tab
??Hmda
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins",
)
)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins",
)
)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins",
)
)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,
dict = c(
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins",
)
)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,
)
etable(
lpm, probit, logit)
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE)
etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~pr2 + n,
digits=2,)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
fitstat = ~ n+r2,
digits=2,
)
fitstat = ~pr2 + n,
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
digits=2,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins",
)
)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
digits=2,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins"
)
)
tab
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
digits=2,
fitstat = ~pr2 + n,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcr" = "Public Bad Credit",
"dmi" = "Denied Mortgage Ins"
)
)
print(tab)
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
digits=2,
fitstat = ~pr2 + n,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcryes" = "Public Bad Credit",
"dmiyes" = "Denied Mortgage Ins"
)
)
#knitr::kable(tab)
knitr::kable(tab)
library("Ecdat")
library("fixest")
library("tidyverse")
data("Hmda")
data <- Hmda %>% mutate(deny = 1*(deny=="yes"),
lvr_high = (lvr > 0.95),
lvr_med = ((0.8 <= lvr) &(lvr <= 0.95)),
)
formula =  as.formula("deny ~ black + dir + hir + lvr_med + lvr_high + ccs + mcs + pbcr+ dmi")
lpm  <- feols(formula, data=data)
probit <- feglm(formula, data=data, family = binomial(link = "probit"))
logit  <- feglm(formula, data=data, family = binomial(link = "logit"))
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
digits=2,
fitstat = ~pr2 + n,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcryes" = "Public Bad Credit",
"dmiyes" = "Denied Mortgage Ins"
)
)
cat(tab)
cat(tab)
tab
cat(tab)
tab
tab<- etable(
lpm, probit, logit,
title = "Loan Denial Models (LPM, Probit, Logit)",
tex = TRUE,
digits=3,
fitstat = ~pr2 + n,
dict = c(
"blackyes" = "Black",
"dir" = "Debt/Income",
"hir" = "Housing/Income",
"lvr_medTRUE" = "LTV: Medium",
"lvr_highTRUE" = "LTV: High",
"ccs" = "Consumer Credit",
"mcs" = "Mortgage Credit",
"pbcryes" = "Public Bad Credit",
"dmiyes" = "Denied Mortgage Ins"
)
)
cat(tab)
tab
unlink("exercises_mle_cache", recursive = TRUE)
unlink("exercises_mle_cache", recursive = TRUE)
